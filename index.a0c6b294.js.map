{"mappings":"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","sources":["src/js/authentification.js"],"sourcesContent":["import {\n  createUserWithEmailAndPassword,\n  signInWithEmailAndPassword,\n  updateProfile,\n} from 'firebase/auth';\nimport { Notify } from 'notiflix';\nimport auth from '../firebase';\nimport { onClickBtnHome } from './homepage';\nimport { hideLoader, showLoader } from './loader';\nconst refs = {\n  logInBtn: document.getElementById('logIn'),\n  logInForm: document.getElementById('logInForm'),\n  signUpForm: document.getElementById('signUpForm'),\n  emailInput: document.querySelector('#email'),\n  passwordInput: document.querySelector('#password'),\n  modal: document.querySelector('.auth-modal'),\n  close: document.getElementById('auth-close'),\n  logOutBtn: document.getElementById('logOutButton'),\n  inputFile: document.getElementById('file'),\n  removeFileBtn: document.getElementById('file-remove-button'),\n};\n// const libraryBtn = document.getElementById('libraryButton');\nconst passRegExp = /(?=.*?[A-Z])(?=.*?[a-z]).{6,}/;\nconst emailRegExp = /^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+$/;\n\n// [SM]get close btn\n\n// [SM] handle click outside of modal to close it\nconst handleClickOutsideModal = e => {\n  if (e.target == refs.modal) {\n    closeAuthModal();\n  }\n};\nconst handleEscClick = e => {\n  if (e.key === 'Escape') {\n    closeAuthModal();\n  }\n};\nconst handleLogOutClicked = () => {\n  console.log('click, logOUT!!!');\n  onClickBtnHome();\n  toggleSignIn();\n};\n// [SM] handle click on close btn in modal to close modal\nconst handleCloseModal = () => {\n  closeAuthModal();\n};\nconst clearUploadedFile = () => {\n  refs.inputFile.style.background = 'unset';\n  refs.removeFileBtn.classList.toggle('hide');\n  refs.inputFile.value = null;\n};\n// [SM] handle error message\nconst setErrorMessage = errors => {\n  errors.forEach(({ el, message }) => {\n    // [SM]take closest parent for easier find error message container related to current  element\n    const formControl = el.closest('.form-control');\n    const errorContainer = formControl.querySelector('small');\n    errorContainer.innerText = message;\n    formControl.className = 'form-control error';\n  });\n};\n// [SM] clear erros to default\nconst clearErrors = () => {\n  const formControls = document.querySelectorAll('.form-control');\n  formControls.forEach(el => {\n    if (el.classList.contains('error')) {\n      el.querySelector('small').innerText = '';\n      el.classList.remove('error');\n    }\n  });\n};\nconst removeEventListeners = () => {\n  window.removeEventListener('click', handleClickOutsideModal);\n  window.removeEventListener('keyup', handleEscClick);\n  refs.close.removeEventListener('click', handleCloseModal);\n  refs.logInForm?.removeEventListener('submit', validateSignInForm);\n  refs.signUpForm?.removeEventListener('submit', validateSignUpForm);\n  refs.removeFileBtn?.removeEventListener('click', clearUploadedFile);\n};\n// [SM] fully close modal and clear listeners\nfunction closeAuthModal() {\n  clearErrorMessage();\n  const authFormElements = document.querySelectorAll('.auth-form');\n  // [SM] reset form\n  refs.logInForm?.reset();\n  refs.signUpForm?.reset();\n  // [SM]remove listeners\n  removeEventListeners();\n  // [SM]hide what should be hidden\n  authFormElements.forEach(el => {\n    if (el.classList.contains('hide')) {\n      return;\n    }\n    el.classList.add('hide');\n  });\n}\nlet errorMessageTimeOut;\n// [SM]Check sign up validation\nconst validateSignUpForm = e => {\n  e.preventDefault();\n  const {\n    elements: { email, password, username, confirmPassword, file },\n  } = e.currentTarget;\n\n  const emailValue = email.value.trim();\n  const nameValue = username.value.trim();\n  const passValue = password.value.trim();\n  const cPasswordValue = confirmPassword.value.trim();\n  const isEmailValid = emailRegExp.test(emailValue);\n\n  let errors = [];\n  if (!nameValue) {\n    errors.push({ el: username, message: 'name cannot be empty' });\n  } else if (15 < nameValue.length < 3) {\n    errors.push({\n      el: username,\n      message: 'name should be at least 3 symbols and not more than 15 symbols',\n    });\n  }\n  if (!emailValue) {\n    errors.push({ el: email, message: 'email cannot be empty' });\n  } else if (!isEmailValid) {\n    errors.push({ el: email, message: 'fill correct email' });\n  }\n  const isPassValid = passRegExp.test(passValue);\n\n  if (!passValue) {\n    errors.push({ el: password, message: 'password cannot be empty' });\n  } else if (!isPassValid) {\n    errors.push({\n      el: password,\n      message:\n        'should contain at least one lower and one upper case and be 6 or more',\n    });\n  } else if (passValue !== cPasswordValue) {\n    errors.push({\n      el: password,\n      message: 'Your password and confirmation password do not match',\n    });\n    errors.push({\n      el: confirmPassword,\n      message: 'Your password and confirmation password do not match',\n    });\n  }\n  setErrorMessage(errors);\n  if (errors.length) {\n    errorMessageTimeOut = setTimeout(() => {\n      clearErrors();\n    }, 5000);\n  } else {\n    showLoader();\n    createUser({ email: emailValue, password: passValue, name: nameValue });\n  }\n};\n// [SM]check Loggin for valid\nconst validateSignInForm = e => {\n  e.preventDefault();\n  const {\n    elements: { email, password },\n  } = e.currentTarget;\n  const emailValue = email.value.trim();\n  const passValue = password.value.trim();\n  let errors = false;\n  if (!emailValue) {\n    setErrorMessage(email, 'email cannot be empty');\n  }\n  if (!passValue) {\n    setErrorMessage(password, 'password cannot be empty');\n  }\n  if (passValue.length < 6) {\n    setErrorMessage(password, 'password cannot less than 6 symbols');\n  }\n  return errors\n    ? (errorMessageTimeOut = setTimeout(() => {\n        clearErrors();\n      }, 5000))\n    : toggleSignIn(emailValue, passValue);\n};\n// [SM] clear timeOut\nfunction clearErrorMessage() {\n  clearTimeout(errorMessageTimeOut);\n}\n// [SM] create user\nasync function createUser({ email, password, name }) {\n  await createUserWithEmailAndPassword(auth, email, password)\n    .then(async userCredential => {\n      const user = userCredential.user;\n      if (user) {\n        await updateProfile(user, { displayName: name })\n          .then(() => {})\n          .catch(err => {\n            Notify.warning(\"Name wasn't saved\");\n          });\n      }\n      var displayName = user.displayName;\n      const userContainer = document.querySelector('#userContainer');\n      if (userContainer) {\n        userContainer.innerText = displayName;\n      }\n    })\n    .catch(error => {\n      hideLoader();\n\n      const errorCode = error.code;\n      const errorMessage = error.message;\n      Notify.failure(errorMessage);\n    });\n}\n// [SM] check sign in or should logout\nfunction toggleSignIn(email, password) {\n  console.log('come to toggle: ');\n  if (auth.currentUser) {\n    togglePrivateRoutes();\n\n    auth.signOut();\n  } else {\n    showLoader();\n    // [SM] Sign in with email and pass.\n    signInWithEmailAndPassword(auth, email, password)\n      .then(() => {\n        hideLoader();\n      })\n      .catch(function (error) {\n        // [SM] Handle Errors here.\n        var errorCode = error.code;\n\n        var errorMessage = error.message;\n        if (errorCode === 'auth/wrong-password') {\n          Notify.failure('Wrong email or password!');\n        } else if (errorCode === 'auth/user-not-found') {\n          Notify.failure(\"User doesn't exist\");\n        } else {\n          Notify.failure(errorMessage);\n        }\n        hideLoader();\n      });\n  }\n}\nauth.onAuthStateChanged(function (user) {\n  if (user) {\n    togglePrivateRoutes();\n    refs.logOutBtn.addEventListener('click', handleLogOutClicked);\n\n    // [SM] User is signed in.\n    let displayName = user.displayName;\n    if (displayName) {\n      const userContainer = document.querySelector('#userContainer');\n      if (userContainer) {\n        userContainer.innerText = displayName;\n      }\n    }\n\n    var uid = user.uid;\n    var providerData = user.providerData;\n    hideLoader();\n    closeAuthModal();\n  } else {\n    refs.logOutBtn?.removeEventListener('click', handleLogOutClicked);\n\n    hideLoader();\n  }\n});\n\n// [SM] Hide what user should not see if not logged\nfunction togglePrivateRoutes() {\n  const privateRoutes = document.querySelectorAll('.private-route');\n  privateRoutes.forEach(routeElement => routeElement.classList.toggle('hide'));\n}\n// [SM]\nfunction handleAddAvatar() {\n  const value = e.currentTarget.value;\n  if (value) {\n    const url = window.URL.createObjectURL(refs.inputFile.files[0]);\n    refs.inputFile.style.background = `url(${url}) no-repeat 100px center / 30px calc(100% - 4px)`;\n    refs.removeFileBtn.classList.toggle('hide');\n    refs.removeFileBtn.addEventListener('click', clearUploadedFile);\n  } else {\n    refs.removeFileBtn.classList.toggle('hide');\n    refs.inputFile.style.background = 'unset';\n    refs.removeFileBtn.removeEventListener('click', clearUploadedFile);\n  }\n}\n\n// [SM] open login form\nfunction showLogInForm() {\n  refs.modal.classList.toggle('hide');\n  refs.logInForm.classList.remove('hide');\n  // [SM] handle click outside of modal to close it\n  window.addEventListener('click', handleClickOutsideModal);\n  // [SM] handle click escape  to close   modal\n  window.addEventListener('keyup', handleEscClick);\n  refs.close.addEventListener('click', handleCloseModal);\n  // [SM] logInForm.classList.toggle('hide');\n  refs.emailInput.focus();\n  refs.logInForm.addEventListener('submit', validateSignInForm);\n}\n// [SM] open sign in form\nfunction showSignInForm() {\n  refs.modal.classList.toggle('hide');\n  const parentWrapper = refs.signUpForm.closest('.auth-form');\n  parentWrapper.classList.remove('hide');\n  refs.inputFile.addEventListener('change', handleAddAvatar);\n\n  // [SM] handle click outside of modal to close it\n  window.addEventListener('click', handleClickOutsideModal);\n  // [SM] handle click escape  to close   modal\n  window.addEventListener('keyup', handleEscClick);\n  refs.close.addEventListener('click', handleCloseModal);\n\n  refs.signUpForm.addEventListener('submit', validateSignUpForm);\n}\n// [SM] Access auth elements\nconst authAction = document.querySelectorAll('.auth__button');\n\n// [SM] check attribute what action\nauthAction.forEach(item => {\n  item.addEventListener('click', e => {\n    let chosen = e.target.getAttribute('auth');\n    if (chosen === 'show-log-in-form') {\n      if (auth.currentUser) {\n        // [SM] if user logged in, then it was clicke to logout so lets do logout\n        togglePrivateRoutes();\n\n        return auth.signOut();\n      }\n      showLogInForm();\n    } else {\n      showSignInForm();\n    }\n  });\n});\n"],"names":["$amyG6","parcelRequire","$ae21fa622dbc0564$var$refs","logInBtn","document","getElementById","logInForm","signUpForm","emailInput","querySelector","passwordInput","modal","close","logOutBtn","inputFile","removeFileBtn","$ae21fa622dbc0564$var$passRegExp","$ae21fa622dbc0564$var$emailRegExp","$ae21fa622dbc0564$var$handleClickOutsideModal","e","target","$ae21fa622dbc0564$var$closeAuthModal","$ae21fa622dbc0564$var$handleEscClick","key","$ae21fa622dbc0564$var$handleLogOutClicked","console","log","$dqy6Z","onClickBtnHome","$ae21fa622dbc0564$var$toggleSignIn","$ae21fa622dbc0564$var$handleCloseModal","$ae21fa622dbc0564$var$clearUploadedFile","style","background","classList","toggle","value","$ae21fa622dbc0564$var$setErrorMessage","errors","forEach","el","message","formControl","closest","innerText","className","$ae21fa622dbc0564$var$clearErrors","querySelectorAll","contains","remove","ref","ref3","clearTimeout","$ae21fa622dbc0564$var$errorMessageTimeOut","authFormElements","reset","ref1","ref2","window","removeEventListener","$ae21fa622dbc0564$var$validateSignInForm","$ae21fa622dbc0564$var$validateSignUpForm","$ae21fa622dbc0564$var$removeEventListeners","add","preventDefault","elements","email","password","username","confirmPassword","file","currentTarget","emailValue","trim","nameValue","passValue","cPasswordValue","isEmailValid","test","length","push","isPassValid","setTimeout","$gjiCh","showLoader","async","name","createUserWithEmailAndPassword","$f1Qqb","default","then","userCredential","user","updateProfile","displayName","catch","err","$eWCmQ","Notify","warning","userContainer","error","hideLoader","code","errorMessage","failure","$ae21fa622dbc0564$var$createUser","currentUser","$ae21fa622dbc0564$var$togglePrivateRoutes","signOut","signInWithEmailAndPassword","errorCode","routeElement","$ae21fa622dbc0564$var$handleAddAvatar","url","URL","createObjectURL","files","addEventListener","onAuthStateChanged","uid","providerData","item","getAttribute","focus"],"version":3,"file":"index.a0c6b294.js.map"}